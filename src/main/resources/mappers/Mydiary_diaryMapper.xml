<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ibreed_project.dao.IMydiary_diaryDAO">

    <!-- ResultMap 정의 -->
    <resultMap id="DiaryResultMap" type="com.ibreed_project.model.Mydiary_diaryVO">
        <id property="diaryPostId" column="diary_post_id"/>
        <result property="diaryId" column="diary_id"/>
        <result property="diaryTitle" column="diary_title"/>
        <result property="diaryContent" column="diary_content"/>
        <result property="diaryFile" column="diary_file"/>
        <result property="diaryCreate" column="diary_create"/>
        <result property="diaryUpdate" column="diary_update"/>
        <result property="diaryViews" column="diary_views"/>
        <result property="diaryLike" column="diary_like"/>
        <result property="diaryUploadStatus" column="diary_upload_status"/>
        <result property="diaryWeather" column="diary_weather"/>
        <result property="diaryTag" column="diary_tag"/>
        <result property="diaryPublic" column="diary_public"/>
        <result property="diaryCategory" column="diary_category"/>
        <result property="commentCount" column="comment_count"/>
        <result property="isDeleted" column="is_deleted"/>
          <result property="userId" column="user_id"/>
    </resultMap>

    <!-- INSERT 쿼리 -->
    <insert id="insertDiary" parameterType="com.ibreed_project.model.Mydiary_diaryVO">
    INSERT INTO diaryboard (
        diary_id, diary_title, diary_content, diary_file
       , diary_views, diary_like, diary_upload_status, 
          diary_public, diary_category, comment_count, 
        is_deleted, user_id
    )
    SELECT
        d.diary_id, #{diaryTitle}, #{diaryContent}, #{diaryFile}, 0,0
       ,1, #{diaryPublic}, #{diaryCategory}, 0, 0, #{userId}
    FROM
        diary d
    WHERE
        d.user_id = #{userId}
</insert>

    <!-- SELECT 쿼리 -->
    <select id="getDiaryById" resultMap="DiaryResultMap" parameterType="int">
        SELECT * FROM diaryboard WHERE diary_post_id = #{diaryPostId} AND is_deleted = FALSE
    </select>
    <!--일기리스트가져오는 쿼리문  -->
    
    
	<select id="getDiaryListByUserIdAndVisibility" parameterType="map" resultType="com.ibreed_project.model.Mydiary_diaryVO">
    SELECT diary_post_id, diary_id, diary_title, diary_create, diary_category, diary_views, diary_public
    FROM diaryboard 
    WHERE diary_id = (
        SELECT diary_id 
        FROM diary 
        WHERE user_id = #{userId}
    )
    <if test="isOwner">
        
    </if>
    <if test="!isOwner and isFriend">
        AND diary_public IN ('전체공개', '친구공개')
    </if>
    <if test="!isOwner and !isFriend">
        AND diary_public = '전체공개'
    </if>
    ORDER BY diary_create DESC
</select>
    <!-- UPDATE 쿼리 -->
    <update id="updateDiary" parameterType="com.ibreed_project.model.Mydiary_diaryVO">
        UPDATE diaryboard
        SET diary_title = #{diaryTitle},
            diary_content = #{diaryContent},
            diary_file = #{diaryFile},
            diary_update = NOW(),
            diary_upload_status = #{diaryUploadStatus},
            diary_weather = #{diaryWeather},
            diary_tag = #{diaryTag},
            diary_public = #{diaryPublic},
            diary_category = #{diaryCategory}
        WHERE diary_post_id = #{diaryPostId}
    </update>

</mapper>
